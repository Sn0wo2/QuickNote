FROM alpine:latest AS builder

RUN addgroup -S appgroup && adduser -S appuser -G appgroup

COPY . /build/
WORKDIR /build/

RUN mkdir -p /app/static
RUN mv QuickNote config.yml /app/
RUN sh -c 'mv * /app/static/ 2>/dev/null || true'

FROM scratch

COPY --from=builder /etc/passwd /etc/passwd
COPY --from=builder /etc/group /etc/group
COPY --from=builder --chown=appuser:appgroup /app /opt/quicknote

USER appuser
WORKDIR /opt/quicknote
EXPOSE 3000
CMD ["./QuickNote"]